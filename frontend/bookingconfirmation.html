<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Puki Hotel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="" />
    <link rel="stylesheet" type="text/css"
        href="//fonts.googleapis.com/css?family=|Roboto+Sans:400,700|Playfair+Display:400,700">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/aos.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.timepicker.css">
    <link rel="stylesheet" href="css/fancybox.min.css">

    <link rel="stylesheet" href="fonts/ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="fonts/fontawesome/css/font-awesome.min.css">

    <!-- Theme Style -->
    <link rel="stylesheet" href="css/style.css">
    <style>
        .payment-confirmation {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Header Section */
        .status {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .status .icon {
            color: green;
            font-size: 28px;
            margin-right: 10px;
        }

        .status h2 {
            font-size: 25px;
            color: #333;
            margin: 0;
            font-weight: bold;
        }

        .booking-summary p {
            margin-top: 10px;
            font-size: 16px;
        }

        .details {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid #ddd;
            padding: 10px 0;
        }

        .details div {
            text-align: left;
        }

        .details div p {
            margin: 5px 0;
        }

        .details div strong {
            font-weight: bold;
        }

        .details-bottom {
            justify-content: space-between;
            padding: 10px 0;
        }

        .details-bottom {
            margin: 5px 0;
        }

        .details-bottom p strong {
            font-weight: bold;
        }
    </style>
</head>

<body>

    <header>
        <div class="container-fluid">
            <div class="row align-items-center" style="height: 80px;"> <!-- Adjust height -->
                <!-- Logo Section -->
                <div class="col-6 col-lg-4 site-logo text-center" data-aos="fade">
                    <a href="index.html"
                        style="font-size: 28px; font-weight: bold; text-decoration: none; color: #000;">Puki Hotel</a>
                </div>

                <!-- Toggle Menu Section -->
                <div class="site-menu-toggle js-site-menu-toggle" data-aos="fade" style="margin-top: 15px;">
                    <span style="background-color: #000"></span>
                    <span style="background-color: #000"></span>
                    <span style="background-color: #000"></span>
                </div>

                <!-- Navigation Menu -->
                <div class="site-navbar js-site-navbar" style="display: none;">
                    <nav role="navigation">
                        <div class="container">
                            <div class="row full-height align-items-center">
                                <div class="col-md-6 mx-auto">
                                    <ul class="list-unstyled menu text-center">
                                        <li><a href="index.html">Home</a></li>
                                        <li><a href="about.html">About</a></li>
                                        <li><a href="events.html">Events</a></li>
                                        <li><a href="contact.html">Contact</a></li>
                                        <li><a href="checkin.html">Check-In / Check-Out</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
        </div>
    </header>
    <!-- END head -->
    <!-- Booking Information Section -->
    <section class="section bg-light py-5 text-center" data-aos="fade-up" data-aos-delay="100">
        <h2 style="font-weight: bold; font-size: 28px;">Booking Confirmation</h2>
        <p>Thank you for choosing your stay at Puki Hotel. Please check your email for the booking confirmation.</p>
    </section>
    <section>
        <div class="container payment-confirmation"
            style="justify-content: center; padding: 40px; max-width: 1300px; margin-top: 50px; margin-bottom: 50px;" data-aos="fade-up" data-aos-delay="100">
            <div class="status">
                <span class="icon">âœ”</span>
                <h2>Booking Confirmed</h2>
            </div>
            <p>We are pleased to inform you that your booking has been received and confirmed. We look forward to seeing
                you soon!</p>
            <div class="booking-summary">
                <h2 style="margin-top: 30px; margin-bottom: 20px;  font-size: 25px; font-weight: bold;">Booking Details
                </h2>

                <div class="details">
                    <div>
                        <p>Booking ID:</p>
                        <p><strong id="bookingId">-</strong></p>
                    </div>
                    <div>
                        <p>Check-in Date:</p>
                        <p><strong id="checkInDate">-</strong></p>
                    </div>
                    <div>
                        <p>Check-out Date:</p>
                        <p><strong id="checkOutDate">-</strong></p>
                    </div>
                    <div>
                        <p>Room:</p>
                        <p><strong id="roomType">-</strong></p>
                    </div>
                    <div>
                        <p>Price:</p>
                        <p><strong id="totalCost">-</strong></p>
                    </div>
                    <div>
                        <p>Status:</p>
                        <p><strong>Confirmed</strong></p>
                    </div>
                </div><h2 style="margin-top: 30px; margin-bottom: 20px;  font-size: 25px; font-weight: bold;">Guest Details</h2>
                <div class="details">
                    <div>
                        <p>Name:</p>
                        <p><strong id="fullName">-</strong></p>
                    </div>
                    <div>
                        <p>Email:</p>
                        <p><strong id="email">-</strong></p>
                    </div>
                    <div>
                        <p>Phone:</p>
                        <p><strong id="phoneNumber">-</strong></p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="section footer-section py-5">
        <div class="container">
            <div class="row mb-4">
                <div class="col-md-3 mb-5">
                    <ul class="list-unstyled link">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Terms &amp; Conditions</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-5">
                    <ul class="list-unstyled link">
                        <li><a href="#">Rooms</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-5 pr-md-5 contact-info">
                    <p><span class="d-block"><span class="ion-ios-location h5 mr-3 text-primary"></span>Address:</span>
                        <span> 304 Orchard Road, Singapore 536203</span>
                    </p>
                    <p><span class="d-block"><span class="ion-ios-telephone h5 mr-3 text-primary"></span>Phone:</span>
                        <span> (+65) 6738 3274</span>
                    </p>
                    <p><span class="d-block"><span class="ion-ios-email h5 mr-3 text-primary"></span>Email:</span>
                        <span> inquiries@pukihotel.com</span>
                    </p>
                </div>
                <div class="col-md-3 mb-5">
                    <p>Sign up for our newsletter</p>
                    <form action="#" class="footer-newsletter">
                        <div class="form-group">
                            <input type="email" class="form-control" placeholder="Email...">
                            <button type="submit" class="btn"><span class="fa fa-paper-plane"></span></button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row pt-5">
                <p class="col-md-6 text-left">
                    Copyright &copy;
                    <script>document.write(new Date().getFullYear());</script> All rights reserved | This template
                    is made with <i class="icon-heart-o" aria-hidden="true"></i> by Colorlib
                </p>

                <p class="col-md-6 text-right social">
                    <a href="#"><span class="fa fa-tripadvisor"></span></a>
                    <a href="#"><span class="fa fa-facebook"></span></a>
                    <a href="#"><span class="fa fa-twitter"></span></a>
                    <a href="#"><span class="fa fa-linkedin"></span></a>
                    <a href="#"><span class="fa fa-vimeo"></span></a>
                </p>
            </div>
        </div>
    </footer>

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/jquery.timepicker.min.js"></script>

    <script src="js/main.js"></script>
    <script src="js/paymentsummary.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="js/payment.js"></script>
    
    <script>
        const BOOKING_URL = "http://localhost:5002";
        const GUEST_URL = "http://localhost:5011";

        document.addEventListener("DOMContentLoaded", function () {
        const bookingId = JSON.parse(localStorage.getItem("bookingDetails"))?.bookingId;

        if (!bookingId) {
            console.warn("No booking ID found in localStorage.");
            return;
        }

        fetch(`http://localhost:5002/booking/${bookingId}`)
            .then(res => {
                if (!res.ok) throw new Error("Booking fetch failed");
                return res.json();
            })
            .then(async bookingData => {
                const booking = bookingData.data;

                document.getElementById("bookingId").textContent = booking.booking_id;
                document.getElementById("checkInDate").textContent = booking.check_in;
                document.getElementById("checkOutDate").textContent = booking.check_out;
                document.getElementById("roomType").textContent = booking.room_type;
                document.getElementById("totalCost").textContent = `$${booking.price}`;

                // Fetch guest data
                const guestRes = await fetch(`http://localhost:5011/guest/${booking.guest_id}`);
                if (!guestRes.ok) throw new Error("Guest fetch failed");
                const guestData = await guestRes.json();
                const guest = guestData.data;

                document.getElementById("fullName").textContent = guest.name;
                document.getElementById("email").textContent = guest.email;
                document.getElementById("phoneNumber").textContent = guest.contact;


                const message = `Hi ${guest.name}, your booking at Puki Hotel is confirmed!\n` +
                    `Booking ID: ${booking.booking_id}\n` +
                    `Room: ${booking.room_type}\n` +
                    `Check-in: ${booking.check_in}\n` +
                    `Check-out: ${booking.check_out}`;
                
                console.log("Notification message to be sent:", message);

                const notificationPayload = {
                    recipient: "91455020", // hardcoded number since the api is on free trial 
                    message: message,
                    type: "SMS"
                };

                fetch("http://localhost:5007/notify", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(notificationPayload)
                })
                .then(res => res.json())
                .then(data => {
                    console.log("Notification sent:", data);
                })
                .catch(error => {
                    console.error("Notification failed:", error);
                });

            })
            .catch(err => {
                console.error("Error fetching confirmation data:", err.message);
            });
    });
        </script>
        

</body>

</html>